# 工廠訂便當系統 - 測試計劃

## 測試環境準備

### 1. 啟動服務
```bash
python app.py
```
確認服務運行在 `http://localhost:5000`

### 2. 測試工具
- 瀏覽器（用於訪問根路由）
- Postman / cURL / Python requests（用於 API 測試）
- 命令行介面（用於核心邏輯測試）

---

## 一、基礎功能測試

### 1.1 服務啟動測試
- [ ] 訪問 `http://localhost:5000` 應顯示 API 信息頁面
- [ ] 確認所有 API 端點列在頁面上
- [ ] 檢查終端沒有錯誤訊息

### 1.2 數據初始化測試
- [ ] 確認 `data/` 目錄已創建
- [ ] 確認以下文件存在：
  - [ ] `data/departments.json`（包含3個預設部門）
  - [ ] `data/employees.json`（包含3個預設員工）
  - [ ] `data/windows.json`（包含1個預設窗口）
  - [ ] `data/orders.json`（空字典）

---

## 二、員工端功能測試

### 2.1 登入功能
**測試步驟：**
1. POST `/api/employee/login`
   ```json
   {
     "emp_id": "93800",
     "password": "1234"
   }
   ```
2. 檢查返回結果應包含 `success: true` 和員工信息
3. 測試錯誤密碼應返回 `success: false`
4. 測試不存在的員工編號應返回錯誤

**預期結果：**
- [ ] 正確密碼登入成功
- [ ] 錯誤密碼登入失敗
- [ ] Session 正確設置（可通過 `/api/check-session` 驗證）

### 2.2 今日訂單查詢
**測試步驟：**
1. 先登入員工帳號
2. GET `/api/employee/today-orders`
3. 檢查返回的訂單數據結構

**預期結果：**
- [ ] 返回當天日期
- [ ] 包含 `lunch` 和 `dinner` 字段
- [ ] 包含截止時間狀態（`lunch_cutoff`, `dinner_cutoff`）

### 2.3 訂購功能
**測試步驟：**
1. 登入員工帳號
2. POST `/api/employee/order`
   ```json
   {
     "meal_type": "LUNCH",
     "diet_type": "MEAT",
     "rice_portion": "FULL"
   }
   ```
3. 確認訂單創建成功
4. 再次查詢今日訂單，確認訂單存在

**預期結果：**
- [ ] 訂單創建成功
- [ ] 在截止時間前可以訂購
- [ ] 訂單包含正確的餐點選項

### 2.4 截止時間控制
**測試步驟：**
1. 測試午餐截止時間（08:30）
   - 模擬時間在 08:30 之後
   - 嘗試訂購午餐應失敗
2. 測試晚餐截止時間（16:00）
   - 模擬時間在 16:00 之後
   - 嘗試訂購晚餐應失敗

**預期結果：**
- [ ] 截止時間後無法訂購
- [ ] 返回適當的錯誤訊息
- [ ] 晚餐截止時間前仍可訂購午餐（如果未截止）

### 2.5 取消訂單
**測試步驟：**
1. 先創建一個訂單
2. POST `/api/employee/cancel-order`
   ```json
   {
     "meal_type": "LUNCH"
   }
   ```
3. 查詢今日訂單確認已取消

**預期結果：**
- [ ] 訂單取消成功
- [ ] 在截止時間前可以取消
- [ ] 截止時間後無法取消

### 2.6 一週訂餐
**測試步驟：**
1. GET `/api/employee/weekly-orders?week_type=current`
2. 檢查返回的一週訂單數據
3. POST `/api/employee/weekly-orders`
   ```json
   {
     "orders": [
       {
         "date": "2024-01-15",
         "meal_type": "LUNCH",
         "diet_type": "MEAT",
         "rice_portion": "FULL"
       },
       {
         "date": "2024-01-15",
         "meal_type": "DINNER",
         "diet_type": "VEG",
         "rice_portion": "HALF"
       }
     ]
   }
   ```

**預期結果：**
- [ ] 能獲取本週訂單
- [ ] 能獲取下週訂單（week_type=next）
- [ ] 批量訂購成功
- [ ] 已截止的日期無法訂購

### 2.7 歷史訂單查詢
**測試步驟：**
1. GET `/api/employee/history?date_from=2024-01-01&date_to=2024-01-31`
2. 檢查返回的歷史訂單列表

**預期結果：**
- [ ] 返回指定日期區間的所有訂單
- [ ] 訂單按日期排序
- [ ] 包含完整的訂單信息

### 2.8 登出功能
**測試步驟：**
1. POST `/api/employee/logout`
2. GET `/api/check-session` 確認 session 已清除

**預期結果：**
- [ ] 登出成功
- [ ] Session 已清除
- [ ] 登出後無法訪問需要登入的端點

---

## 三、管理員端功能測試

### 3.1 管理員登入
**測試步驟：**
1. POST `/api/admin/login`
   ```json
   {
     "account": "admin",
     "password": "1234"
   }
   ```
2. 檢查返回結果

**預期結果：**
- [ ] 正確帳號密碼登入成功
- [ ] 錯誤帳號密碼登入失敗
- [ ] Session 正確設置

### 3.2 部門主檔維護
**測試步驟：**
1. GET `/api/admin/departments` - 獲取部門列表
2. POST `/api/admin/departments` - 新增部門
   ```json
   {
     "DeptCode": "D40",
     "DeptName": "研發部"
   }
   ```
3. POST `/api/admin/departments` - 修改部門（包含 OID）
4. DELETE `/api/admin/departments/<oid>` - 刪除部門

**預期結果：**
- [ ] 能獲取所有部門
- [ ] 新增部門成功
- [ ] 修改部門成功
- [ ] 刪除部門成功
- [ ] 重複部門代號無法新增
- [ ] 數據正確保存到文件

### 3.3 員工主檔維護
**測試步驟：**
1. GET `/api/admin/employees` - 獲取員工列表（確認密碼已隱藏）
2. POST `/api/admin/employees` - 新增員工
   ```json
   {
     "EmpID": "99999",
     "EmpName": "測試員工",
     "Password": "test123",
     "DeptCode": "A10"
   }
   ```
3. POST `/api/admin/employees` - 修改員工
4. DELETE `/api/admin/employees/<oid>` - 刪除員工

**預期結果：**
- [ ] 能獲取所有員工（密碼已隱藏）
- [ ] 新增員工成功
- [ ] 修改員工成功
- [ ] 刪除員工成功
- [ ] 重複員工編號無法新增
- [ ] 不存在的部門代號無法關聯

### 3.4 窗口主檔維護
**測試步驟：**
1. GET `/api/admin/windows` - 獲取窗口列表
2. POST `/api/admin/windows` - 新增窗口
   ```json
   {
     "EmpID": "93800",
     "ResponsibleDeptCodes": ["A10", "B20"]
   }
   ```
3. POST `/api/admin/windows` - 修改窗口
4. DELETE `/api/admin/windows/<oid>` - 刪除窗口

**預期結果：**
- [ ] 能獲取所有窗口
- [ ] 新增窗口成功
- [ ] 修改窗口成功
- [ ] 刪除窗口成功
- [ ] 同一員工不能重複設置為窗口
- [ ] 不存在的員工無法設置為窗口

### 3.5 訂單查詢與修改
**測試步驟：**
1. GET `/api/admin/orders?date_from=2024-01-01&date_to=2024-01-31`
2. 檢查返回的訂單列表
3. GET `/api/admin/orders?date_from=2024-01-01&date_to=2024-01-31&dept_code=A10`
4. 測試部門篩選
5. PUT `/api/admin/orders` - 修改訂單
   ```json
   {
     "date": "2024-01-15",
     "emp_id": "93800",
     "meal_type": "LUNCH",
     "diet_type": "VEG",
     "rice_portion": "HALF",
     "is_cancelled": false
   }
   ```
6. 測試取消訂單（`is_cancelled: true`）

**預期結果：**
- [ ] 能查詢所有訂單
- [ ] 能按部門篩選
- [ ] 能按員工篩選
- [ ] 管理員修改不受截止時間限制
- [ ] 修改後訂單標記為 AdminModified

### 3.6 統計報表
**測試步驟：**
1. GET `/api/admin/stats/meal-quantity?date_from=2024-01-01&date_to=2024-01-31`
2. 檢查餐點數量統計
3. GET `/api/admin/stats/employee-orders?date_from=2024-01-01&date_to=2024-01-31`
4. 檢查員工訂購統計

**預期結果：**
- [ ] 餐點數量統計正確
- [ ] 員工訂購統計正確
- [ ] 統計數據包含所有必要字段

---

## 四、數據一致性測試

### 4.1 數據文件完整性
- [ ] 所有操作後數據文件格式正確
- [ ] JSON 格式有效
- [ ] 數據結構符合預期

### 4.2 關聯性測試
- [ ] 刪除部門時，關聯的員工數據是否受影響（預期：不自動刪除，但需檢查）
- [ ] 刪除員工時，該員工的訂單是否保留（預期：保留歷史訂單）
- [ ] 刪除窗口時，相關數據是否正確處理

### 4.3 並發測試
- [ ] 多個用戶同時訂購同一餐點
- [ ] 同時修改主檔數據
- [ ] Session 管理正確

---

## 五、邊界條件測試

### 5.1 日期邊界
- [ ] 查詢過去日期
- [ ] 查詢未來日期
- [ ] 查詢跨月日期區間
- [ ] 查詢跨年日期區間

### 5.2 輸入驗證
- [ ] 空值處理
- [ ] 特殊字符處理
- [ ] 長字符串處理
- [ ] 非法格式處理

### 5.3 錯誤處理
- [ ] 未登入訪問受保護端點
- [ ] 無權限訪問管理員端點
- [ ] 無效的 API 路徑
- [ ] 缺失必需參數

---

## 六、命令行介面測試

### 6.1 核心邏輯測試
**測試步驟：**
```bash
python FoodOrder.py
```

**測試項目：**
- [ ] 員工登入功能
- [ ] 訂購功能
- [ ] 取消訂單
- [ ] 歷史查詢
- [ ] 管理員功能

### 6.2 數據持久化測試
- [ ] 命令行操作後，數據文件正確更新
- [ ] Web API 讀取命令行操作的數據
- [ ] 命令行讀取 Web API 操作的數據

---

## 七、整合測試場景

### 場景 1：完整訂餐流程
1. 員工登入
2. 查看今日訂單（無訂單）
3. 訂購午餐
4. 訂購晚餐
5. 查看今日訂單（確認兩筆訂單）
6. 取消午餐
7. 查看今日訂單（只剩晚餐）

### 場景 2：一週批量訂餐
1. 員工登入
2. 獲取本週訂單列表
3. 批量創建一週訂單
4. 查詢歷史訂單確認

### 場景 3：管理員維護流程
1. 管理員登入
2. 新增部門
3. 新增員工（關聯新部門）
4. 設置窗口
5. 查詢該部門訂單
6. 修改訂單
7. 查看統計報表

### 場景 4：截止時間測試
1. 模擬不同時間點
2. 測試午餐截止時間限制
3. 測試晚餐截止時間限制
4. 測試管理員不受限制

---

## 八、性能測試（可選）

- [ ] 大量訂單查詢性能
- [ ] 批量訂購性能
- [ ] 數據文件讀寫性能

---

## 測試結果記錄表

| 測試項目 | 測試狀態 | 備註 |
|---------|---------|------|
| 服務啟動 | ☐ 通過 ☐ 失敗 | |
| 員工登入 | ☐ 通過 ☐ 失敗 | |
| 訂購功能 | ☐ 通過 ☐ 失敗 | |
| 取消訂單 | ☐ 通過 ☐ 失敗 | |
| 管理員登入 | ☐ 通過 ☐ 失敗 | |
| 部門維護 | ☐ 通過 ☐ 失敗 | |
| 員工維護 | ☐ 通過 ☐ 失敗 | |
| 訂單查詢 | ☐ 通過 ☐ 失敗 | |
| 統計報表 | ☐ 通過 ☐ 失敗 | |

---

## 測試注意事項

1. **測試前準備**
   - 備份現有數據文件（如需）
   - 確認服務正常運行
   - 準備測試數據

2. **測試順序**
   - 建議按功能模塊順序測試
   - 先測試基礎功能，再測試複雜場景
   - 最後進行整合測試

3. **測試記錄**
   - 記錄每個測試用例的實際結果
   - 記錄發現的問題和錯誤訊息
   - 記錄數據變化情況

4. **清理工作**
   - 測試完成後可選擇清理測試數據
   - 恢復到初始狀態（如需要）

